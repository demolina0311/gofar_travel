-- Punto 1
-- PARA SUPLIR LA NECESIDAD DEL CLIENTE DE HACER UN SEGUIMIENTO A LOS VEHICULOS SE CREA UNA VISTA DE LA TABLA INVOICES
-- YA QUE EN ESTA TABLA ESTA EL ID DEL VEHICULO Y LA FECHA CUANDO CAMBIO DE ESTADO.
CREATE OR REPLACE VIEW historical_data_for_vehicles 
AS 
SELECT I.VEHICLE_ID AS VEHICLE, V.TYPE, I.DATE_INVOICE, I.ID AS INVOICE FROM INVOICES I INNER JOIN VEHICLES V ON I.VEHICLE_ID = V.ID 
UNION
SELECT I.VEHICLE_EXCHANGED_ID AS VEHICLE, V.TYPE, I.DATE_INVOICE, I.ID AS INVOICE  FROM INVOICES I INNER JOIN VEHICLES V ON I.vehicle_exchanged_id = V.ID
UNION
SELECT ID , TYPE, NULL, NULL  FROM VEHICLES WHERE TYPE = 'NEW';

SELECT * FROM HISTORICAL_DATA_FOR_VEHICLES

-- CREAR CONSTRAINTS AL CAMPO TYPE DE LA TABLA VEHICLES
ALTER TABLE VEHICLES ADD CONSTRAINT CK_TYPE
      CHECK (TYPE IN ('NEW','TRADE','SOLD'));


-- Punto 2      
-- AGREGAR UNA COLUMNA A LA TABLA ITEMS QUE TENGA POR DEFECTO EL VALOR DE 30
ALTER TABLE ITEMS ADD (units_available INT DEFAULT 30 NOT NULL);


-- Punto 3
-- VISTA CON ITEMS MENORES A 5, no se agregan las columnas código y nombre del fabricante porque la tabla no las posee
CREATE OR REPLACE VIEW under_five_units_availables 
AS 
SELECT ID, DESCRIPTION FROM ITEMS WHERE units_available < 5;

SELECT * FROM UNDER_FIVE_UNITS_AVAILABLES;